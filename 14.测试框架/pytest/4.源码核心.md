# 简介
在pytest研究源码的过程中,发现pluggy插件系统其实是pytest的核心,可以说pytest只是将多个插件利用pluggy构建出来的项目.

# pluggy

pluggy 不可以动态插入，即无法在程序运行的过程中利用插件添加新的功能。

pluggy 主要有 3 个概念：
1. PluginManager：用于管理插件规范与插件本身
2. HookspecMarker：定义插件调用规范，每个规范可以对应 1~N 个插件，每个插件都满足该规范，否则无法成功被外部调用
3. HookimplMarker：定义插件，插件逻辑具体的实现在该类装饰的方法中

simple e.g.:
```py
import pluggy


# 创建插件规范类装饰器
hookspec = pluggy.HookspecMarker("example")
# 创建插件类装饰器
hookimpl = pluggy.HookimplMarker("example")


class MySpec:

    @hookspec
    def myhook(self, a, b):
        pass


class Plugin_1:

    @hookimpl
    def myhook(self, a, b):
        return a + b


class Plugin_2:

    @hookimpl
    def myhook(self, a, b):
        return a * b


# 创建manger和添加hook规范
pm = pluggy.PluginManager("example")
pm.add_hookspecs(MySpec)

# 注册插件
pm.register(Plugin_1())
pm.register(Plugin_2())

res = pm.hook.myhook(a=10, b=20)
print(res)
```

1. 通过 HookspecMarker 类装饰器定义插件调用规范
2. 通过 HookimplMarker 类装饰器定义插件逻辑
3. 创建 PluginManager 并绑定插件调用规范与插件本身
4. 调用插件