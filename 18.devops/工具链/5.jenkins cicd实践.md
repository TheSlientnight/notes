# jenkins CICD pipeline
方案参考: 微医devops实践: https://testerhome.com/topics/9977

## 概览:
- 采用 jenkins pipeline + share library + scm 方式 很方便维护 大体量级的cicd
1. 将常规step提取出来,封装成模块库
2. 将函数 + pipeline 抽象后 封装成模板库
3. 外部源代码控制 share library

- 采用 容器 做slave 可以实现 无阻碍并发构建
1. 使用Docker
2. 使用kubernetes

继承原有slave,构建符合自己使用的slave镜像
- 开发环境依赖
- 测试环境依赖

## 详细设计:

- 步骤
1. 拉取代码(此处采用多流水线的方式,jenkins会自动设定webhook,自行拉取构建,所以不用人工设定)
2. 单元测试
3. 静态检查
    - sonarqube
    - 质量阀(sonarquebe gate)
4. build & push
    - build镜像
    - push仓库
5. 部署环境(依据branch自行判断,ssh到目标机部署)
    - 开发
    - 测试
    - 预生产
    - 生产(由人工判断部署时机)
6. 并发执行
    - 自动化接口(构建job)
    - 自动化ui(构建job)
    - 组件依赖安全(构建job)
7. 人工验收通知


## 工程目录
```
share-library
    ├─ src
    ├─ vars
    │   ├── pipelineTemplate.groovy
    │   ├── unitTest.groovy
    │   ├── sonarQube.groovy
    │   ├── qualityGate.groovy
    │   ├── deploy.groovy
    │   ├── mailPost.groovy
    └─ resource
```