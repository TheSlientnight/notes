# 基本使用
1. 引用环境变量：`${ENV(变量名))}`, 在根目录下的.env中定义环境变量
2. `variables`用来存储全局变量, 调用`username: $username`
3. `extract`用来提取响应数据
4. 调用自定义函数`${自定义变量}`
5. 内置状态可提取：status_code, cookies, elapsed, headers, content, text, json, encoding, ok, reason, url
6. check指定断言字段
7. comparator指定操作类型：相等：eq, 小于：lt, 小于等于：lte, 大于：gt, 大于等于：gte,字符串相等：str_eq, 长度等于len_eq, len_lt, len_lte, len_gt, len_gte, 包含：contains, 被包含：contains_by
8. 尽量保证每级用例都可独立运行
9. 优先级：离的越近的模块越优先，然后找下层，以此类推
```yaml
name: 登录接口
base_url: http://127.0.0.1:8000 # 全局路由
variables:  # 全局变量
    username: ${ENV(USERNAME)}  # 提取环境变量
    password: ${ENV(PASSWORD)}
request:
    url: /user/login
    method: POST
    headers:
        Content-Type: "application/json"
    json:
        username: $username
        password: $password
        time: ${get_time("参数")}  # 调用自定义函数
validate:
    # 内置状态可提取：status_code, cookies, elapsed, headers, content, text, json, encoding, ok, reason, url
    - eq: ["status_code", 200]
    - er: ["headers.Content-Type", "application/json"]
    - {check: "headers.Content-Type", comparator: "eq", expect: "application/json"}  # 与上方一致,上方为缩写
    # check: 目标字段, comparator: 操作类型, expect: 预期结果
    - {check: "json.username", comparator: "contains", expect: "something"}
extract:
    - uname: content.username

```
## 自定义函数
在根目录的debugtalk.py中自定义函数
```py
# debugtalk.py
def get_time(data):
    print(data)
    return time.time()
```
## 数据驱动
### 测试用例
在api文件中只做通用的简单断言,特异性的断言放在集合中做
```yaml
config:
    name: 登录接口
    variables:
        device_sn: abc
        username: ${ENV(USERNAME)}
        password: ${ENV(PASSWORD)}
        title: 正常测试  # 此处设定的目的是单独调用时,默认配置
        status_code: 200
        contain_msg: token
    base_url: http://127.0.0.1:8000

teststeps:
-
    name: $title  # 调用数据驱动参数
    api: teststeps/login.yml  # 此处为teststeps的文件路径
    # 继承api目录下登录接口,本区域属性内容会继承api文件中属性
    variables:  # 此处优先级高于同级config和底层
        user_agent: IOS/10.3
        device_sn: $device_sn

    extract:
        - token: content.token
    validate:
        - eq: [status_code, $status_code]
        - {check: content, comparator: contains, expect: username}  # content为字典,包含匹配的为key
        - {check: content, comparator: contains, expect: $contain_msg}
```
### 测试套件
```yaml
config:
    name: "接口测试套件"
    variables: 
        device_ sn: "XYZ"
    base_ url: http://127.0.0.1:8000

testcases:
-
    name: 登录接口
    testcase: testcases/login.yml  # 设定testcase的用例文件路径
    variables: 
        device_sn: $device_sn
    parameters:  # 在该属性中实现数据驱动
        # 方式一：
        # 1. 多个具有关联性的参数需要集中定义,采用-连接
        - title-username-password-status_code-contain_msg:  # 相较底层属性,优先级最高
            - ["正常登录", "hahaxixi", "123456", 200, "token"]
            - ["密码错误", "hahaxixi", "1234567", 400, "non_field_error"]

        # 方式二：
        # 使用csv文件来保存测试数据
        - title-username-password-status_code-contain_msg: ${P(ACOUNT.CSV)}  # 指定csv文件地址
        # 用该方法会存在 因为读取csv文件都是str类型 而断言错误

        # 方法三：推荐使用
        # 使用函数动态生成，需要返回列表嵌套字典
        - title-username-password-status_code-contain_msg: ${get_param()}
```
方法二：ACOUNT.CSV
```csv
title,username,password,status_code,contain_msg
正常登录,hahaxixi,123456,200,token
密码错误,hahaxixi,123457,400,non_field_errors
账号错误,hahaxixi123,123456,400,non_field_errors
用户名为空,,123456,400,username
密码为空,kehahaxixiyou,,400,password
```
方法三：debugtalk.py设置自定义函数
```py
def get_param():
    data = [
        {"title": "正常登录", "username": "hahaxixi", "password": "123456", "status_code": 200, "contain_msg": "token"},
        {"title": "密码错误", "username": "hahaxixi", "password": "123457", "status_code": 400, "contain_msg": "non_field_errors"},
    ]
    return data

```
## 运行
```py
from httprunner.api import HttpRunner


# 1. 创建HttpRunner对象
runner = HttpRunner(failfast=False)  # failfast失败后是否停止

# 2. 运行用例
runner.run("path")  # 参数可传：用例文件，字典用例

runner.summary  # 结果文件



```
项目：
id: int(11)
name: char(255)
leader. char(255}
tester <ha1(255)
programmer char(2
publish. app chan25
desc <ha(255)
create_time: datetim 
update_time: datetir 
is_delete: smallint(0)

接口
id: int(11)
name char(255)
project int(255)
tester. cha1(255)
desc chan255)
create. _time: datetime(O)
update. _time datetime(0)
is. delete smalintO)

用例：
id: int(11)
name char(255)
interface. int(1l) 
include: cha1(255)
author char(255)
request varchar(255)
create. _time datetime(0) 
update. _time datetime(O)
is. delete smallint(0;

配置
id: int(11)
name char(255)
interface int(11) author. char(255)
request varchan(255; create. time datetime(O)
update. _time datetime(0)
is delete smalint(O}

suits
id: int(11)
name: char(255) project int(11)
include <har(255)
request varchar(255)
create_. time: datetime(O)
update. time datetime(0)
is_delete smallint(O)

env
id: int(11)
name: (har(255)
base. urt varchar(255)
desc var<har(255)
create. _time datetime(0) update. _time datetime(0)
is_, delete smallint0)


tb reportsid: 
id int(11)
name (har(255)
result: smallint(O)
count int(11)
success int11)
html vaichar(255)
summay var<han255)
create. _time datetime(0) update__time datetime(O)
is_delete smallint(O)

用户
auth user 
id: int(0)
usemame char(O)
password: char(O)
email cha(O)
first. name chan0) last name chan255)
is_. staff smallint(O) is_active smallint(0)
date joined datetime(O)


tb debugtalks 
id: int(11》
name char(255)
project int(11)
debugtalk varchar(255)
create_time datetime(O)
update__time datetime(0)
is. delete smallint(0)