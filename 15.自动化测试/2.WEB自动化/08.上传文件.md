# 上传文件篇

## 环境安装

库： pywin32
工具：winspy
链接: https://pan.baidu.com/s/1fJ4I6B4f7FSC5S2XHWKC-w 密码: tn59
## 与autoit的差异

    autoit需要学习autoit的脚本语言在其提供的编辑器里面编写脚本，存在学习门槛问题
    还需要将其脚本生成为exe文件，再由代码去调用，不够优化
    pywin32库，可以由python直接编写，直接运行，但是缺点是要一层层的往里面找到要操作的文件输入框
    
## 使用

以chrome为例：
    
    1.利用winspy工具找到 【title】 【文件路径输入框】 【提交按钮】 的title和class
    2.溯源至最顶层（title）并记录相关的title和class

##【title】:
![title](https://upload-images.jianshu.io/upload_images/20499241-3f4350105bd173f2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 【文件路径输入框】:
- 输入框class 需要继续找到其父级
![输入框](https://upload-images.jianshu.io/upload_images/20499241-2f77f1d2e7a74102.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![window窗口找到父级](https://upload-images.jianshu.io/upload_images/20499241-d0ffef9d1815f8b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 第一层父级
![父级1](https://upload-images.jianshu.io/upload_images/20499241-bdd6ff93dcfa6218.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 第二层父级
![image.png](https://upload-images.jianshu.io/upload_images/20499241-a2ab891c10688e08.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- 找到title层父级即停止
![title层](https://upload-images.jianshu.io/upload_images/20499241-de87b23e4891f263.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## 【提交按钮】：
- 按钮层
![image.png](https://upload-images.jianshu.io/upload_images/20499241-8aa2e4483c1c5afd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
- title层
![image.png](https://upload-images.jianshu.io/upload_images/20499241-2f6e7c2a45136d7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)




函数说明：

    1. win32gui.FindWindow(lpClassName, lpWindowName)   # class，值title
    2. win32gui.FindWindowEx(Parent, childafter, calss, window)  # 父对象, 从第几个下级开始, 类名, text
    3. win32gui.SendMessage(handle, msg, param, param)  # 父对象, 消息对象, 参数, 参数

```python
import win32con 
import win32gui


def upload_file(file_path):
    # title仅支持chrome
    title = win32gui.FindWindow("#32770", "打开")

    # 二级窗口，4个参数：父级；从父级的第几个儿子开始检索，0表示第一个；自身类名；文本内容，没有则None
    comboboxex32 = win32gui.FindWindowEx(title, 0, "ComboBoxEx32", None)
    combobox = win32gui.FindWindowEx(comboboxex32, 0, "ComboBox", None)
    edit = win32gui.FindWindowEx(combobox, 0, "Edit", None)

    button = win32gui.FindWindowEx(title, 0, "Button", "打开(&O)")

    win32gui.SendMessage(edit, win32con.WM_SETTEXT, None, file_path)
    win32gui.SendMessage(title, win32con.WM_COMMAND, 1, button)  # 按钮处引用的是title
```