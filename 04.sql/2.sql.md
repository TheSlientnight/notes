一、简介
1.什么叫数据库
在项目中存放和处理数据的软件叫做数据库
2.测试人员为什么要学习数据库
a、验证数据的正确性；b、专项测试时造数据(主要指的是性能测试)

3.数据库的分类
关系型数据库和非关系型数据库
关系型数据库：
DB2：处理海量的数据，主要用于银行系统，IBM公司开发
Oracle：处理大量的数据，主要用于电信、电商、互联网公司，Oracle公司开发，中文名甲骨文
sql server：小型数据库，主要用于C++、C#等程序的开发，微软公司开发，早期版本只支持windows操作系统
MySQL：小型数据库，主要用于互联网公司，早期开源，后期被Oracle收购闭源

非关系型数据库：
nosql、mongodb

4.Oracle的版本(8i,9i,10g,11g,12c)
i：Internet  互联网
g：gird  网格
c：cloud  云

5.安装
1.电脑之前没有安装Oracle，使用win+r运行services.msc，查看电脑是否有Oracle开头的服务

2.关闭杀毒软件和防火墙
3.设置静态的IP地址
4.设置兼容性，以管理员身份运行
5.安装路径不要有中文

6.修改密码
sqlplus / as sysdba
----------------------------------------------------------------------------------------------
二、登录数据库
----------------------------------------------------------------------------------------------
登录本地数据库
1.启动oracle实例服务,使用cmd命令窗口登录，win+r运行cmd， 然后输入
sqlplus system/sh2018  system  是超级用户
2.使用SQLplus工具，开始菜单找到Oracle的安装目录，然后找到应用程序开发，然后打开SQLplus，输入用户名system，密码sh2018



3.使用pl/sql工具远程登录，打开pl/sql工具，输入用户名system，密码sh2018
1.更改D:\oracle\product\10.2.0\db_1\NETWORK\ADMIN\tnsnames.ora（客户端的文件）文件中的内容，如下
ORCL =
  (DESCRIPTION =
(ADDRESS = (PROTOCOL = TCP)(HOST = 2011-20170731HB)(PORT = 1521))
(CONNECT_DATA =
  (SERVER = DEDICATED
  (SERVICE_NAME = orcl)
)
  )

ORCL238 =
  (DESCRIPTION =
(ADDRESS = (PROTOCOL = TCP)(HOST = 
192.168.13.238)(PORT = 1521))
(CONNECT_DATA =
  (SERVER = DEDICATED)
  (SERVICE_NAME = orcl)实例名==数据库名字
)
  )
  
2.cmd下tnsping orcl238，如果返回OK，表示环境能联通
连接问题解决：如果提示连接监听超时说明被连接的数据库没有开启监听
如果提示无法解析字符说明配置文件时有问题，检查配置文件。

3.使用cmd窗口运行sqlplus system/sh2018@orcl238
  使用SQLplus工具登录，输入用户名system，密码sh2018，字符连接串orcl238
  使用pl/sql工具登录，输入用户名system，密码sh2018，database输入orcl238
plusqlcommand窗口和SQL窗口的区别：SQL窗口是执行sql窗口用来执行select、insert,alter、create等语句;
命令的窗口用来执行命令语句,如查表结构。如desc  表名 OracleOraDb10g_home1TNSListener  监听程序，当使用plsql远程工具登录时需要启动状态，如果别人想连接你的数据库一定要开这个。
OracleServiceORCL 数据库服务，必须启动这个服务数据库才可以操作。
监听和服务（这几个命令是直接在dos窗口下执行的不需要登录到数据库）
启动监听 lsnrctl start
查看监听 lsnrctl status
停止监听 lsnrctl stop
启动服务 net start oracleserviceorcl
停止服务 net stop oracleserviceorcl
----------------------------------------------------------------------------------------------
三、基本语句
----------------------------------------------------------------------------------------------
1.新建用户 语法
create user laozhang identified by  laoli;

2.查询新建的用户(dba_users是视图，不能往视图中插入、删除、修改数据，只能 查询)
select  *  from dba_users where username='LAOZHANG';

3.授权
connect：连接权限，用于对数据的增删改查
resource：资源使用权限，用于创建表格等（单有这个权限不一定有连接权限）
dba：数据库管理权限，用于创建用户、表空间等 （ 所有权限都有）
赋予权限的语句
grant connect,resource,dba  to laozhang;
切换用户命令 conn  qq;
查看当前登录的用户 show user

4.--查询用户的权限
select * from user_role_privs;        --查询第一次登录用户的权限
select  *  from dba_role_privs     where grantee='LAOZHANG';   --查询LAOZHANG用户的权限

5.回收权限
revoke dba,resource from laozhang;

6.修改密码
alter user laozhang identified by sh2018;  

7.加锁
alter user laozhang account lock;

8.解锁
alter user laozhang account unlock; 

9.加锁、解锁的同时修改密码
alter user laozhang account lock identified by laozhang;
alter user laozhang account unlock identified by laozhang;                                                    

10.删除用户，用户下如果有数据库对象直接删除用户会失败，需要加上cascade，数据库对象有：表、视图、索引、序列、存储过程、触发器、包等……
drop user laowang;

drop user laowang cascade;
11.杀死用户的进程，（如果加cascade还删不掉就执行下面语句）
SELECT Saddr, Sid, Serial#, Paddr, Username, Status
  FROM V$session  where username='ABC';
杀sid 和Serial#
alter system kill session '36,1683';

11.切换登录用户：
conn  


四、创建表
----------------------------------------------------------------------------------------------
1.什么是表的结构
表是用来组织和整理数据的一种手段
2.数据类型
字符类型：
char :定长字符类型，就是定义多长就会占多少个字符不够自动使用空格占位
varchar：可变字符长度类型，输入多少个就占多个字符位置，是标准的sql语句的数据类型
varchar2：可变字符长度类型，输入多少个就占多个字符位置为版本之间的兼容定义的数据类型
 
数字类型：number
number(5):表示数字最大储存为5位
number(5.1):表示储存的最大数字为5位，但是必须满足有位1小数
3.日期类型：date        sysdate  
4.转换函数：to_date 转换类型,      to_char 转换成我们的char类型

5.字段约束属性
主键（primary key）：主键约束，不能为                                                                                                                                   空，不能重复，一个表中只能有一个字段
外键（references）：外键的数据依赖于主键中的数据范围，主键中没有的数据类型子表中不能插入
唯一（unique）：存放的数据不能相同，可为以空
默认（default）：新增数据时如果不给值会自动显示默认值
非空（not null）:新增数据时该字段不能为空，必须有值输入
检查（check）：检查往表中增加的数据是否满足定义的要求
格式：  
create table 表名（
  列1  number primary key,
   列2  varchar2(长度)  unique,
   列3  char(长度)  not null ,
   列4  char(长度)   check(列名=‘’or 列名=‘’or.....),
   列5  number  references 表(列),
   列6  date [默认值]  not null


6.创建表 创建表需要resource权限或者DBA权限
create table  student(
sid number(10) primary key,
sname varchar(12) not null,
class char(20) unique,
sex char(2) check(sex='男' or sex='女' or sex='其他'),
sbir date default sysdate
);

1.增加字段
alter table student add phone char(11); 
若增设约束条件，有啥后果
2.删除字段
alter table student drop column class;

3.修改字段
alter table student rename column sid to nn;

4新增约束
alter table student modify  phone unique;  新增unique

5.删除约束
alter table student drop constraint 约束名字;

6.修改约束名字
alter table student rename constraint 旧名 to 新名;

7.修改字符类型
alter table student modify sname char(12)


五、
----------------------------------------------------------------------------------------------
1.插入数据：
格式是：insert into 表名（字段1,字段2,...字段n）
values(值1,值2,....值n)
commit  提交
rollback  回滚
 
insert into man(mid,name,phone)
values('001','xiaobai','18825287000');
commit;

insert into man(mid,name,phone)
values('1001','xiao','18825287001');
rollback;

insert into man(mid,name,phone)
values('1003','xiaohong','18825287002');
commit;
rollback;

2.插入全部数据
insert into man
values('1006','xiaozhang','18825287005',sysdate,'男');
commit;

3.插入部分数据
insert into man(mid,name)
values('1007','张四');

查看表中个字段的约束
select constraint_name,constraint_type,column_name
 from user_constraints natural join user_cons_columns where table_name='student';
表中
第一列代表我们的约束名字
第二列字母代表我们的约束类型，U代表唯一约束，P代表主键约束，C代表检查约束和不能为空约束。
第三列代表字段的名字

六、表的操作
----------------------------------------------------------------------------------------------
1.删除表
drop table student;

2.修改表名
rename student to xuesheng;

3.显示表结构
desc student;

--查询表内结构 注释（是不被软件执行的代码，为的是增加代码的可读性 
select *  from man

--在表中出入id为01名字为张三，电话为18825257005这个人的信息

insert into man(mid,name,phone)
values(01,'张三','18825287005')

--在表中输入id为02的人的信息
insert into man(mid,name)
values(02,' ')

--验证当约束为唯一时输入一个空格和两个空格是否算重复
insert into man(mid,name,phone)
values(03,'小红', ' '); 
insert into man(mid,name,phone)
values(04,'小红','  ');


--在表中插入全部数据第一种方法
insert into man
values(4,'小小','1856244',sysdate,'其他')
--在表中插入全部数据第二种方法 就是把所有的字段都写一遍注意顺序

--修改sex字段的数据类型
alter table man modify sex char(4)



4.修改数据
update 表名
set 字段1=值1,字段2=值2,....字段n=值n
[where 条件];
commit|rollback;

update man set mid='1001' where mid='001';
1.修改某行数据中的某几列数据
2.同时修改某几行数据
3.同时修改某几列数据
4.清空某列或某几列数据 注意：null不能加单引号，如果加了单引号表示将性别和deptid内容更改为null
5.数据的加、减、乘、除

5.删除数据
delete 
from 表名

delete 
from man
where mid='1002' or mid=1006 ;

删除所有数据
delete 
from man;
----------------------------------------------------------------------------------------------
补充：
----------------------------------------------------------------------------------------------
truncate table 删除内容，同时释放空间，但是不删除定义，格式truncate table 表名
delete from 表名，删除内容不释放空间可以回滚。
drop table 表名 删除内容，定义释放空间。
----------------------------------------------------------------------------------------------
6.日期时间的操作（修改/插入）
----------------------------------------------------------------------------------------------
插入
insert into man(id,name,brithday)
values('1008','dayu',to_date('2017-11-27 18:20:20','yyyy-mm-dd hh24:mi:ss'));

修改
update man
set birthday=to_date('2017/12/10','yyyy/mm/dd')
where mid='1005';

update man 
set birthday=to_date('18:20:20 2017-12/10','hh24:mi:ss yyyy-mm/dd')
where mid='1008';


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--查询出所有列信息 * 代表所有列 sh代表的是表名
select *  from  sh;

--只想显示出第一列和第二列怎么表示
select sh_id,sh_name from sh;

--使用where关键字进行筛选出自己想查询的数据

select sh_name,sh_year
from sh
where  sh_id=4

--d第二种方法
select *
from sh
where sh_name='黄良强'
--给列起别名第一种方法用 as 关键字 
select sh_id as 编号,sh_name as 名字, sh_year as 年龄 
from  sh;
--给列起别名第一种方法不用 as 关键字 

select sh_id  编号,sh_name  名字, sh_year  年龄 
from  sh
--and是且的意思，需要要同时满足所有的条件才能被查找出来,加and查询数据会随着条件的变多而减少
--查询出性别为男并且年龄为24的人的信息
select *  from sh where sh_sex='男' and sh_year=24 
--查询出性别为男并且年龄为24的人的信息id为7的人的信息

select *  from sh where sh_sex='男' and sh_year=24 and sh_id=7


--or 是或者的意思，只要满足其中的一个条件就可以被查找出来，查找的数据随条件的增加而增加



--in 是满足括号中一个条件就可以
--查询出年龄为 20 23 22的人的信息
--第一种通过or查询
select * from sh where sh_year=20 or sh_year=23 or sh_year=22;
--通过in查询
select *  from  sh where sh_year in(20,23,22)


--not in 不在括号中的条件
 select *  from  sh where sh_year not in(20,23,22)
八、单表查询 
----------------------------------------------------------------------------------------------
格式：
select 
from
[where]
----------------------------------------------------------------------------------------------
1.查询全部
select *
from sh;

2.查询指定某条数据显示全部列
select *
from man
where sh_id=1001;

3.只显示某列或某几列数据
select mid，name
from man;
----------------------------------------------------------------------------------------------
4.给列起别名
select mid ID号,name 名字
from man;
----------------------------------------------------------------------------------------------
九、逻辑查询条件 and/or/in/not in   and优先级大于or
----------------------------------------------------------------------------------------------

and是且的意思，需要要同时满足所有的条件才能被查找出来,加and查询数据会随着条件的变多而减少

or 是或者的意思，只要满足其中的一个条件就可以被查找出来，查找的数据随条件的增加而增加

in 是满足括号中一个条件就可以

not in 不在括号中的条件

----------------------------------------------------------------------------------------------
1.and条件查询
列：查询出工资sal大于1200并且员工编号 empno大于7000的所有员工
select * 
from emp
where sal>1200 and empno>7000;
----------------------------------------------------------------------------------------------
2.or条件查询
例：查询出工资sal大于1200或者员工编号大于7000的员工
select *
from emp
where sal>1200 or empno>7000;
----------------------------------------------------------------------------------------------
3.in条件查询
例：查询出职位为分析师或者为
4.not in 条件查询
5.and和or结合查询

6and优先级大于or的列：
查询出员工职位为clerk 或者部门编号为30的员工信息 并且工资大于1000
select * from emp where (job in('CLERK') or deptno=30) and sal>1000
---------------------------------------------------------------------------------------------------------------
十、去重和比较运算符 distinct 去重复 >  <   >=   <=  <>  !=  范围（between and）
---------------------------------------------------------------------------------------------------------------
1.对名字进行去重操作
select distinct(sname) from student;

1.每个符号写一条查询语句
2.将逻辑运算符合比较运算符结合查询
3.注意between 小 and 大(包含两端的数据)
----------------------------------------------------------------------------------------------
4.时间查询
方法一：select * from emp  where hiredate  between to_date('2017-06-18 00:00:00','yyyy-mm-dd 

hh24:mi:ss')  and to_date('2017-06-18 23:59:59','yyyy-mm-dd hh24:mi:ss');


方法二：select * from dual where birthday=to_date('2017-06-18','yyyy-mm-dd');
------------------------------------------------------------------------------------------------------------------------------------
十一、模糊查找 like  模糊查找通配符 %（模糊匹配任意字符）_(一个_只匹配一个且必须匹配一个)
------------------------------------------------------------------------------------------------------------------------------------

---- ( % ) 

1.前模糊查找
select * from student where  sname like '%李'
2.后模糊查找
select * from student where sname like '李%'
3.前后模糊查找
select  * from student where sname like '%李%'
------------------------------------------------------------------------------------------------------------------
----( _ )

4.占位前模糊查找
select * from where   sname like '_李'
5.占后模糊查找
select * from student  where  sname like '李_'
6.查找前后占位数据
select * from student where  sname like '_李_'
------------------------------------------------------------------------------------------------------------------
十二、为空的查找 is 为null的查找
------------------------------------------------------------------------------------------------------------------
查询为null的数据
select *
from  emp
where comm is null;


查询不为null的数据
select *
from  emp
where comm is not null;

------------------------------------------------------------------------------------------------------------------
十三、查找结果排序
------------------------------------------------------------------------------------------------------------------
select 
from
[where]
[order by ] 列名 desc/asc   desc表示降序 asc 表示升序
默认是asc升序排序，排序函数放在SQL语句的最后面

1.单条件升序排列 asc
2.多条件降序排列 desc
3.多个条件排序
select
from
[where]
order by 字段1 desc,字段2 asc,...字段n(不写默认升序);

十四：多表查询
------------------------------------------------------------------------------------------------------------------
笛卡尔积

多表查询分为：
内连接：又叫等值连接，当被连接的表里面都有该值时才会被显示出来
left左外连接：左边表的数据全部显示出来，右表没有的用空来补全
right右外连接：右边表的数据全部显示出来，左表没有的用空来补全
------------------------------------------------------------------------------------------------------------------
内连接格式：
1. select 列1，列2...列N
from 表1 inner join 表2 on 表1.相同列=表2.相同列 inner join 表3 on 表2.列=表3.列 inner join....表N 
on 表N-1.列=表N.列
[where]
2. select 列1，列2...列n
from 表1，表2，表3....表n
where 表1.列=表2.列 and 表2.列=表3.列 and .....表n-1.列=表点列
------------------------------------------------------------------------------------------------------------------
左外连接格式：
1. select 列1,列2,列3,....列N
from 表1 left join 表2 on 表1.列=表2.列 left join 表3 on 表2.列=表3.列...表n-1.列=表n.列
[where]
select 列1，列2...列n
from 表1，表2，表3....表n
where 表1.列(+)=表2.列 and 表2.列=表3.列（+） and .....表n-1.列=表点列
------------------------------------------------------------------------------------------------------------------
右外连接格式
select 列1,列2,列3,....列n
from 表1 right join 表2 on 表1.列=表2.列  right join 表3 on 表2.列=表3.列...表n-1.列=表n列
[where]
------------------------------------------------------------------------------------------------------------------
分析思路：
1.了解表结构，确定并列出涉及到的表
2.如果需要多张表连表的话，找出各个表中关联字段

1.查询出学生的所在班级（内连接）
select *
from student t,class c
where t.classid=c.classid;

2.在学生表中插入一条数据班级为空，然后利用左查询查询每个学生所对应的班级
insert into student(studentid,sname)
values(1001,'张三');

方法一
select *
from student s left join class c on c.classid
=s.classid

方法二
select *
from student s,class c
where s.classid=c.classid(+)

3.利用右查询查询出每个班级的对应的学生
方法一
select *
from student t right join class c on c.classid=s.classid;

方法二
select *
from student s,class c
where s.classid(+)=c.classid

1.将四张表连起来
student st,class  cl, course co, stscore  se
2.关联关系 
st.classid=cl.classid  st.studentid = se.studentid  se.courseid=co.courseid

select * 
from 
student st,
class  cl, 
course co, 
stscore  se
where
st.classid=cl.classid  and
st.studentid = se.studentid   and
se.courseid=co.courseid;


‘连接之前，要知道信息在哪个表中这个要靠自己去熟悉表或者查询文档

--查询出每个学生所在班级名称(用内连接查询）
分析：显示学生的信息和班级的名称
学生信息在哪个表里面 student表
学生信息在student表中
班级名称在 class表中
那么我们要找这两个表有没有相关联的字段

select *  from student;
select  * from  class;
找出的关联为两个表中的classid
关系为：student.classid=class.classid
select sname,sex,classname
from student,class
where student.classid=class.classid
--显示全部信息
select *
from student,class
where student.classid=class.classid;

--inner join on写法
select *
from student 
inner join class 
on  student.classid=class.classid;


--查询出每个学生所在班级名称(用左外连接查询）
分析：显示学生的信息和班级的名称
学生信息在哪个表里面 student表
学生信息在student表中
班级名称在 class表中
那么我们要找这两个表有没有相关联的字段

select *  from student;
select  * from  class;
找出的关联为两个表中的classid
关系为：student.classid=class.classid
--where写法
select * 
from student,class
where student.classid=class.classid(+)
--第二种写法
select *
from student left join class on student.classid=class.classid

--四表连接
分析四个表中怎么关联在一起
student表和class表连在一起的关系为： student.classid=class.classid
STSCORE表和course表连在一起的关系为：stscore.courseid=course.courseid
student表和stscore表连在一起的关系为：student.studentid=stscore.studentid

select *
from student,course,stscore,class
where  student.classid=class.classid and  stscore.courseid=course.courseid  and student.studentid=stscore.studentid


十五、分组查询：一般用于统计 一般是对有重复内容的字段进行分组
分组函数是对表中一组记录进行操作，每组只返回一个结果。
即首先要对表记录进行分组，然后再进行操作汇总，每组返回
一个结果。分组时可能是整个表分为一组，也可能根据条件分
------------------------------------------------------------------------------------------------------------------
格式：
select 列1,列2,列3....列n
from
[where 表直接的关联条件和筛选条件]
[group by 列1，列2]
[having 过滤]
[order by]

注意事项：
where 是对分组之前的数据进行筛选的
having 是对分组之后的数据进行筛选的

分组聚合函数：将多个值合并成一个值 分组函数作用于一组数据，一般用于数据的统计
avg(列名)：求平均值
sum（列名）：求和
max（列名）：最大值
min（列名）：最小值
count（列名）：统计数据记录/条数 count（*）
round（列名,n）:四舍五入 n代表留几位小数  
round（avg(列名),n） 函数嵌套，先对列进行求平均数，然后进行四舍五入
分组函数的特点：
sum avg一般用于处理数值类型
max min count可以处理任何类型
以上的组函数都会忽略null值

count函数的详细介绍
select count(字段) from 表名 表示通过统计这个字段有多少条数据
select count(*) from 表名 表示通过统计所有的列来统计有多少行

select count(1) from 表名 表示在每行中写入一个数字，也可以写其他的值

分组函数规则
在select这一列中所有未包含在组函数中的列都必须出现在group by当中  
包含在group by字句中的列不必包含在select列当中
不能在where字句中使用组函数
可以在having子句中使用组函数，having后面接的必须是可以出现在select列中的
order by 后面接的必须是可以出现在select列中的

练习：
----统计男生、女生的总数
select count（*） from student group by sex;

---统计每个学员的总分，显示学员id和总分
select sum(score),studentid
from stscore
group by studentid

---统计每个学员的总分，显示姓名，总分
分析：姓名只有在student表中才有 分数在stscoure表中
所以需要多表联查student表和stscore表的关联字段为studentid
联查
select  st.sname,se.studentid,sum(score)
from student st,stscore se
where st.studentid=se.studentid
group by st.studentid



---统计每个男学员的总分，显示姓名，总分
---统计每个学员的总分，显示姓名，最低分,最高分，平均分取两位小数,最后结果按降序排列
select sname,round(avg(score),2),max(score),min(score)
from student st,stscore sc
where st.studentid=sc.studentid
group by sname
order by round(avg(score),2) desc
---round（），四舍五入函数
--统计每个班级的总分，平均分，最高分，最低分
分析：
---------统计每个班级每门课程的总分，平均分，最高分，最低分


--第一题
select sname,round(avg(score),2),max(score),min(score)
from student st,stscore sc
where st.studentid=sc.studentid
group by sname,st.studentid
order by round(avg(score),2) desc
--第二题
select cs1.classid,classname,sum(score),avg(score),max(score),min(score)
from student st,class cs1,stscore sc
where st.studentid=sc.studentid and st.classid=cs1.classid
group by classname,cs1.classid
--第三题
select st.studentid,classname,sc.courseid,cname,sum(score),avg(score),max(score),min(score)
from student st,class cs1,stscore sc,course cr
where sc.courseid=cr.courseid and
sc.studentid=st.studentid and
st.classid=cs1.classid
group by classname,cname,st.studentid,sc.courseid
--第四题
select classname,cname,sum(score),avg(score),max(score),min(score)
from student st,class cs1,stscore sc,course cr
where sc.courseid=cr.courseid and
sc.studentid=st.studentid and
st.classid=cs1.classid
group by classname,cname
having sum(score)>200
order by sum(score) desc
--查询出826班oracle课程的总分、平均分、最高分、最低分
select cs.classname,cr.cname,sum(score),avg(score),max(score),min(score)
from student st,class cs,stscore sc,course cr
where st.classid=cs.classid and
sc.courseid=cr.courseid and
sc.studentid=st.studentid
group by cs.classname,cr.cname
having cs.classname=826 and cr.cname='ORACLE'
